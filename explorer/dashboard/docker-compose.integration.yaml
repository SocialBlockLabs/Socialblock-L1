# Docker Compose configuration for integrating SocialBlock Explorer Dashboard
# with the official SocialBlock L1 repository services
#
# This file should be merged into the official repo's docker-compose.yaml

version: '3.8'

services:
  # SocialBlock Explorer UI Service
  explorer-ui:
    build: 
      context: ./explorer-ui
      dockerfile: Dockerfile
      args:
        - NODE_ENV=production
    container_name: socialblock-explorer-ui
    ports:
      - "3000:80"
    environment:
      # Network configuration
      - NODE_ENV=production
      - VITE_NETWORK=development
      
      # Backend service endpoints (internal Docker network)
      - VITE_RPC_HTTP=http://localhost:3000/rpc
      - VITE_RPC_WS=ws://localhost:3000/ws/websocket
      - VITE_REST_API=http://localhost:3000/api
      - VITE_GRPC=http://localhost:3000/grpc
      - VITE_ARP_AGENT=http://localhost:3000/arp
      - VITE_INDEXER_API=http://localhost:3000/indexer
      - VITE_EXPLORER_API=http://localhost:3000
      
      # Optional configuration
      - VITE_ENABLE_DEBUG=false
      - VITE_ENABLE_ANALYTICS=true
      - VITE_DEFAULT_GAS_PRICE=0.025
    
    depends_on:
      - node
      - arp-agent
      - indexer
    
    networks:
      - socialblock-network
    
    restart: unless-stopped
    
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.explorer.rule=Host(`explorer.localhost`)"
      - "traefik.http.services.explorer.loadbalancer.server.port=80"
    
    volumes:
      # Optional: Mount custom nginx config
      - ./explorer-ui/nginx.conf:/etc/nginx/nginx.conf:ro
      
      # Optional: Mount SSL certificates for production
      # - ./ssl/certs:/etc/ssl/certs:ro
      # - ./ssl/private:/etc/ssl/private:ro
    
    # Resource limits for production
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 256M
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3

networks:
  socialblock-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/16

# Optional: Add volumes for persistent data
volumes:
  explorer-logs:
    driver: local
